<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Interface - Finals Simulator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="styles/main.css" rel="stylesheet">
    <!-- MathJax for LaTeX rendering -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
            },
            startup: {
                ready() {
                    MathJax.startup.defaultReady();
                }
            },
            svg: {
                fontCache: 'global',
                internalSpeechTitles: false
            },
            chtml: {
                displayAlign: 'left'
            }
        };
    </script>
</head>
<body class="bg-light">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-modern sticky-top">
        <div class="container">
            <a class="navbar-brand fw-bold" href="index.html">
                <i class="fas fa-graduation-cap me-2 text-primary"></i>
                Finals Simulator
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="index.html">
                    <i class="fas fa-home me-1"></i>Home
                </a>
                <a class="nav-link" href="creator.html">
                    <i class="fas fa-edit me-1"></i>Question Creator
                </a>
            </div>
        </div>
    </nav>

    <!-- Load Question Set Screen -->
    <div id="loadScreen" class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-6">
                <div class="card card-modern shadow-lg">
                    <div class="card-header bg-primary text-white text-center">
                        <h3 class="mb-0">
                            <i class="fas fa-upload me-2"></i>
                            Load Question Set
                        </h3>
                    </div>
                    <div class="card-body p-5">
                        <div class="text-center mb-4">
                            <i class="fas fa-file-upload fa-3x text-primary mb-3"></i>
                            <p class="lead text-muted">
                                Select a JSON file created by the Question Creator to begin your test.
                            </p>
                        </div>
                        
                        <div class="mb-4">
                            <label for="questionSetFile" class="form-label fw-bold">Choose Question Set File</label>
                            <div class="drag-drop-area" id="dragDropArea">
                                <input type="file" class="form-control" id="questionSetFile" accept=".json" style="display: none;">
                                <div class="drag-drop-content">
                                    <i class="fas fa-cloud-upload-alt drag-drop-icon"></i>
                                    <div class="drag-drop-text">
                                        <div class="drag-drop-primary">Drop JSON file here</div>
                                        <div class="drag-drop-secondary">or <span class="drag-drop-link" id="browseFileBtn">click to browse</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="fileInfo" class="alert alert-info d-none">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-info-circle me-2"></i>
                                <div>
                                    <strong>File loaded successfully!</strong>
                                    <div id="fileDetails" class="small mt-1"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-grid">
                            <button id="startTestBtn" class="btn btn-gradient-primary btn-lg" onclick="startTest()" disabled>
                                <i class="fas fa-play me-2"></i>
                                Start Test
                            </button>
                        </div>
                        
                        <div class="text-center mt-3">
                            <small class="text-muted">
                                Don't have a question set? 
                                <a href="creator.html" class="text-decoration-none">Create one here</a>
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Test Interface Screen -->
    <div id="testScreen" class="d-none">
        <!-- Timer and Test Info -->
        <div class="container-fluid bg-white shadow-sm py-3 sticky-top">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-4">
                        <h5 class="mb-0">
                            <i class="fas fa-clipboard-list me-2 text-primary"></i>
                            <span id="testTitle">Test</span>
                        </h5>
                        <small class="text-muted" id="testSubject">Subject</small>
                    </div>
                    <div class="col-md-4 text-center">
                        <div class="timer-display" id="timerDisplay">
                            <i class="fas fa-clock me-2"></i>
                            <span id="timeRemaining">00:00</span>
                        </div>
                    </div>
                    <div class="col-md-4 text-end">
                        <button class="btn btn-outline-danger" onclick="submitTest()">
                            <i class="fas fa-paper-plane me-2"></i>
                            Submit Test
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Question Display -->
        <div class="container my-4">
            <!-- Test Instructions -->
            <div class="card card-modern shadow mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">
                        <i class="fas fa-info-circle me-2"></i>
                        Test Instructions
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <p class="mb-2">
                                <strong>Instructions:</strong> Read each question carefully and select the best answer. 
                                Click the <i class="fas fa-pencil-alt text-primary"></i> <strong>Answer Sheet</strong> button 
                                (floating on the right) to mark your answers using the scantron-style interface. If the answer is not among the options, select "E" for "None of the above", unless "E" has a corresponding option in the question.
                            </p>
                            <div id="noneOfAboveIndicator" class="alert alert-warning py-2 px-3 mb-0" style="display: none;">
                                <small>
                                    <i class="fas fa-exclamation-triangle me-1"></i>
                                    <strong>Note:</strong> You have selected "E" as "None of the above" for some questions.
                                </small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="alert alert-info mb-0 py-2">
                                <small>
                                    <strong>Answer Changes:</strong> 
                                    <span id="answerChangeStatus" class="fw-bold">Allowed</span>
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- All Questions Display -->
            <div id="allQuestionsContainer">
                <!-- Questions will be rendered here -->
            </div>
        </div>

        <!-- Floating Answer Sheet Button -->
        <button class="floating-scantron" onclick="toggleScantron()" title="Answer Sheet">
            <i class="fas fa-pencil-alt"></i>
        </button>
    </div>

    <!-- Results Screen -->
    <div id="resultsScreen" class="d-none">
        <div class="container py-5">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="card card-modern shadow-lg">
                        <div class="card-header bg-success text-white text-center">
                            <h3 class="mb-0">
                                <i class="fas fa-check-circle me-2"></i>
                                Test Completed!
                            </h3>
                        </div>
                        <div class="card-body p-5">
                            <div class="text-center mb-4">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="p-3 bg-light-gray rounded">
                                            <h2 class="text-primary mb-1" id="finalScore">0%</h2>
                                            <small class="text-muted">Final Score</small>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="p-3 bg-light-gray rounded">
                                            <h2 class="text-success mb-1" id="correctCount">0</h2>
                                            <small class="text-muted">Correct</small>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="p-3 bg-light-gray rounded">
                                            <h2 class="text-danger mb-1" id="incorrectCount">0</h2>
                                            <small class="text-muted">Incorrect</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="detailedResults" class="mt-4">
                                <!-- Detailed results will be shown here -->
                            </div>
                            
                            <div class="text-center mt-4">
                                <button class="btn btn-primary me-2" onclick="retakeTest()">
                                    <i class="fas fa-redo me-2"></i>
                                    Retake Test
                                </button>
                                <button class="btn btn-outline-secondary" onclick="loadNewTest()">
                                    <i class="fas fa-file-upload me-2"></i>
                                    Load New Test
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scantron Modal -->
    <div class="modal fade" id="scantronModal" tabindex="-1">
        <div class="modal-dialog modal-fullscreen-lg-down modal-xl">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-pencil-alt me-2"></i>
                        Answer Sheet
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-12 mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">Questions Answered: <span id="answeredCount">0</span> / <span id="totalQuestionsScantron">0</span></h6>
                                <div class="progress" style="width: 200px;">
                                    <div class="progress-bar" id="progressBar" role="progressbar" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="scantronGrid" class="scantron-grid">
                        <!-- Scantron bubbles will be generated here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="submitTest()">
                        <i class="fas fa-paper-plane me-2"></i>
                        Submit Test
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/test.js"></script>
</body>
</html>
